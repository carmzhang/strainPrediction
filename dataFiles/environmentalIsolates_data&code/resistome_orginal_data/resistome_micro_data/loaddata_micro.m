%{
01/09/2019
The code is used to extract micro plate reader data, blank the data and
save as mat file.
Each row in mat file is time sequence of 1 well / the growth curve of 1
strain.
1 strain has 6 replicates.
%}

clear; clc;

filename = {
    '09012018_resistome_longterm_TS30_9-1.xlsx',...
    '09072018_resistome_longterm_TS30_11-1.xlsx',...
    '09012018_resistome_longterm_TS30_12-2.xlsx',...
    '09202018_resistome_longterm_TS30_13-1.xlsx',...
    '09212018_resistome_longterm_TS30_14-1.xlsx',... 
    '09242018_resistome_longterm_TS30_15-1.xlsx',...
    '09252018_resistome_longterm_TS30_16-1.xlsx',...
    '09262018_resistome_longterm_TS30_17-1.xlsx',...
    '09272018_resistome_longterm_TS30_18-1.xlsx',...
    '09282018_resistome_longterm_TS30_19-1.xlsx',...
    '09292018_resistome_longterm_TS30_20-1.xlsx',...
    '10012018_resistome_longterm_TS30_21-1.xlsx',...
    '10022018_resistome_longterm_TS30_22-1.xlsx',...
    '10052018_resistome_longterm_TS30_23-1.xlsx',...
    '10102018_resistome_longterm_TS30_24-1.xlsx',...
    '10112018_resistome_longterm_TS30_25-1.xlsx',...
    '10122018_resistome_longterm_TS30_26-1.xlsx',...
    '10132018_resistome_longterm_TS30_27-1.xlsx',...
    '10142018_resistome_longterm_TS30_28-1.xlsx',...
    '10152018_resistome_longterm_TS30_29-1.xlsx',...
    '10212018_resistome_longterm_TS30_33-1.xlsx',...
    '10232018_resistome_longterm_TS30_34-1.xlsx',...
    '10242018_resistome_longterm_TS30_35-1.xlsx',...
    '10252018_resistome_longterm_TS30_36-1.xlsx',...
    '10262018_resistome_longterm_TS30_37-1.xlsx',...
    '10292018_resistome_longterm_TS30_39-1.xlsx',...
    '10302018_resistome_longterm_TS30_40-1.xlsx',...
    '11022018_resistome_longterm_TS30_41-2.xlsx',...
    '11052018_resistome_longterm_TS30_42-2.xlsx',...
    '11122018_resistome_longterm_TS30_43-1.xlsx',...
    '11152018_resistome_longterm_TS30_44-1.xlsx',...
    '11192018_resistome_longterm_TS30_45-1.xlsx',...
    '11222018_resistome_longterm_TS30_46-1.xlsx',...
    '11252018_resistome_longterm_TS30_47-1.xlsx',...
    '11292018_resistome_longterm_TS30_48-1.xlsx',...
    '12122018_resistome_longterm_TS30_51-1.xlsx',...
    '12172018_resistome_longterm_TS30_52-1.xlsx',...
    '12182018_resistome_longterm_TS30_53-1.xlsx',...
};

newname = {
    '9-1.mat'...
    '11-1.mat'...
    '12-2.mat'...
    '13-1.mat'...
    '14-1.mat'...
    '15-1.mat'...
    '16-1.mat'...
    '17-1.mat'...
    '18-1.mat'...
    '19-1.mat'...
    '20-1.mat'...
    '21-1.mat'...
    '22-1.mat'...
    '23-1.mat'...
    '24-1.mat'...
    '25-1.mat'...
    '26-1.mat'...
    '27-1.mat'...
    '28-1.mat'...
    '29-1.mat'...
    '33-1.mat'...
    '34-1.mat'...
    '35-1.mat'...
    '36-1.mat'...
    '37-1.mat'...
    '39-1.mat'...
    '40-1.mat'...
    '41-1.mat'...
    '42-1.mat'...
    '43-1.mat'...
    '44-1.mat'...
    '45-1.mat'...
    '46-1.mat'...
    '47-1.mat'...
    '48-1.mat'...
    '51-1.mat'...
    '52-1.mat'...
    '53-1.mat'...
};

filenum = length(filename);
%%
for n = 1:filenum
    n
    AA = xlsread(filename{n},'F:F');
    Row = size(AA,1)/99/12;
    P = Row*12; %plate size

    % recorganized data
    D = [];
    for i = 1:Row*12
        for k = 1:99
            D(i,k) = AA(i+(k-1)*P);
        end
    end

    % extract last six row, which are the blank, and get mean value. 
    % DD: blanked all data
    blank = mean(D(P-5:P,:));
    data = D - blank;
    %delete blank
    data = data(1:P-6,:);

    %save data as matfile
    save(newname{n},'data');
end




